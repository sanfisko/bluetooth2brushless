# Инструкция по установке и настройке

## Требования к программному обеспечению

### Arduino IDE
1. Скачайте и установите Arduino IDE с официального сайта: https://www.arduino.cc/en/software
2. Запустите Arduino IDE

### Установка поддержки ESP32
1. Откройте `Файл` → `Настройки` (File → Preferences)
2. В поле "Дополнительные URL менеджеров плат" добавьте:
   ```
   https://raw.githubusercontent.com/espressif/arduino-esp32/master/package_esp32_index.json
   ```
3. Нажмите "OK"
4. Откройте `Инструменты` → `Плата` → `Менеджер плат` (Tools → Board → Boards Manager)
5. Найдите "ESP32" и установите пакет "ESP32 by Espressif Systems"

### Настройка платы
1. Подключите ESP32 к компьютеру через USB
2. В Arduino IDE выберите:
   - `Инструменты` → `Плата` → `ESP32 Arduino` → `ESP32 Dev Module`
   - `Инструменты` → `Порт` → выберите соответствующий COM-порт
   - `Инструменты` → `Скорость загрузки` → `115200`

## Загрузка прошивки

1. Откройте файл `bluetooth2brushless.ino` в Arduino IDE
2. Нажмите кнопку "Проверить" (галочка) для компиляции
3. Нажмите кнопку "Загрузить" (стрелка) для загрузки на ESP32
4. Дождитесь завершения загрузки

## Проверка работы

### Мониторинг через Serial
1. Откройте `Инструменты` → `Монитор порта`
2. Установите скорость 115200 бод
3. Вы должны увидеть сообщения инициализации системы

### Сопряжение с Bluetooth
1. На телефоне/планшете включите Bluetooth
2. Найдите устройство "ESP32_Motor_Control"
3. Выполните сопряжение (пароль не требуется)

## Тестирование команд

### Через Bluetooth-терминал
Установите приложение Bluetooth Terminal (например, "Serial Bluetooth Terminal" для Android) и отправьте команды:
- `+` - увеличить скорость
- `-` - уменьшить скорость  
- `P` - изменить направление
- `S` - остановить двигатель
- `E` - включить/выключить двигатель

### Через пульт BT13
1. Включите пульт BT13
2. Выполните сопряжение с ESP32
3. Используйте кнопки:
   - Vol+ (Увеличение громкости) - увеличение скорости
   - Vol- (Уменьшение громкости) - уменьшение скорости
   - Play/Pause - изменение направления

## Устранение неполадок

### ESP32 не определяется
- Проверьте USB-кабель (должен поддерживать передачу данных)
- Установите драйверы CH340/CP2102 для вашей ОС
- Попробуйте другой USB-порт

### Ошибки компиляции
- Убедитесь, что установлен пакет ESP32
- Проверьте выбор правильной платы
- Перезапустите Arduino IDE

### Bluetooth не подключается
- Проверьте, что ESP32 запущен и инициализирован
- Убедитесь, что Bluetooth включен на устройстве
- Попробуйте "забыть" устройство и подключиться заново

### Двигатель не реагирует
- Проверьте подключение проводов согласно схеме
- Убедитесь в правильности питания контроллера
- Проверьте общий GND между ESP32 и контроллером
- Измерьте напряжение на выходе PWM (должно изменяться от 0 до 3.3V)

## Дополнительные настройки

### Изменение параметров PWM
В файле `bluetooth2brushless.ino` можно изменить:
```cpp
const int freq = 1000;          // Частота PWM (Гц)
const int speedStep = 10;       // Шаг изменения скорости
const int maxSpeed = 255;       // Максимальная скорость
```

### Изменение имени Bluetooth
```cpp
SerialBT.begin("ESP32_Motor_Control");  // Замените на желаемое имя
```

### Настройка таймаута
```cpp
const unsigned long commandTimeout = 5000; // Таймаут в миллисекундах
```

## Безопасность

⚠️ **ВАЖНО**: 
- Всегда отключайте питание при подключении проводов
- Не превышайте номинальные характеристики двигателя и контроллера
- Обеспечьте надежное крепление двигателя
- Используйте предохранители в цепи питания
- Не оставляйте систему без присмотра при работе на высоких скоростях