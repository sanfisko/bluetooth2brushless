# üéØ –§–ò–ù–ê–õ–¨–ù–ê–Ø –ò–ù–°–¢–†–£–ö–¶–ò–Ø - ESP-IDF v5.4.1 –ü–û–õ–ù–û–°–¢–¨–Æ –ò–°–ü–†–ê–í–õ–ï–ù

## üìã –ö—Ä–∞—Ç–∫–æ–µ —Ä–µ–∑—é–º–µ
–í—Å–µ –æ—à–∏–±–∫–∏ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ –∏ runtime –¥–ª—è ESP-IDF v5.4.1 —É—Å–ø–µ—à–Ω–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã. –ü—Ä–æ–µ–∫—Ç –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é.

## ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. ‚ùå –û—à–∏–±–∫–∏ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏
- **ESP_HID_MODE_CLASSIC_BT** ‚Üí **HID_HOST_MODE**
- **Callback API** –æ–±–Ω–æ–≤–ª–µ–Ω –¥–ª—è v5.4.1
- **–ù–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ** —É–¥–∞–ª–µ–Ω—ã
- **CMakeLists.txt** –∏—Å–ø—Ä–∞–≤–ª–µ–Ω

### 2. ‚ùå Runtime –æ—à–∏–±–∫–∞ ESP_ERR_INVALID_ARG
- **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Bluetooth** –æ–±–Ω–æ–≤–ª–µ–Ω–∞
- **sdkconfig.defaults** –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è BR_EDR_ONLY
- **–ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞** –¥–æ–±–∞–≤–ª–µ–Ω–∞

### 3. ‚ùå –ü—Ä–æ–±–ª–µ–º–∞ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –ø—É–ª—å—Ç–∞
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫** –ø—Ä–∏ –æ—Ç–∫–ª—é—á–µ–Ω–∏–∏ –ø—É–ª—å—Ç–∞
- **–ó–∞–¥–∞—á–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞** —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
- **–ù–µ–±–ª–æ–∫–∏—Ä—É—é—â–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏** –≤ callback
- **–ó–∞—â–∏—Ç–∞ –æ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è** –ø–æ–∏—Å–∫–∞

## üöÄ –ö–æ–º–∞–Ω–¥—ã –¥–ª—è —Å–±–æ—Ä–∫–∏ –∏ –ø—Ä–æ—à–∏–≤–∫–∏

```bash
# 1. –û–±–Ω–æ–≤–∏—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
cd ~/bluetooth2brushless
git pull origin main

# 2. –ü–µ—Ä–µ–π—Ç–∏ –≤ –ø–∞–ø–∫—É –ø—Ä–æ–µ–∫—Ç–∞
cd esp-idf-version

# 3. –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å ESP-IDF
. ~/esp/esp-idf/export.sh

# 4. –û—á–∏—Å—Ç–∏—Ç—å –∏ —Å–æ–±—Ä–∞—Ç—å
idf.py fullclean
idf.py set-target esp32
idf.py build

# 5. –ü—Ä–æ—à–∏—Ç—å –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å
idf.py -p /dev/ttyUSB0 flash monitor
```

## üìä –û–∂–∏–¥–∞–µ–º—ã–µ –ª–æ–≥–∏ –ø–æ—Å–ª–µ –ø—Ä–æ—à–∏–≤–∫–∏

```
I (xxx) BT13_MOTOR_CONTROL: === ESP32 HID Host Motor Control ===
I (xxx) BT13_MOTOR_CONTROL: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã...
I (xxx) BT13_MOTOR_CONTROL: –î–≤–∏–≥–∞—Ç–µ–ª—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω
I (xxx) BT13_MOTOR_CONTROL: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è BT –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞...
I (xxx) BT13_MOTOR_CONTROL: –í–∫–ª—é—á–µ–Ω–∏–µ BT –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞...
I (xxx) BT13_MOTOR_CONTROL: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Bluedroid...
I (xxx) BT13_MOTOR_CONTROL: –í–∫–ª—é—á–µ–Ω–∏–µ Bluedroid...
I (xxx) BT13_MOTOR_CONTROL: HID Host –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω
I (xxx) BT13_MOTOR_CONTROL: –ó–∞–¥–∞—á–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –∑–∞–ø—É—â–µ–Ω–∞
I (xxx) BT13_MOTOR_CONTROL: –ü–æ–∏—Å–∫ –ø—É–ª—å—Ç–∞ BT13 (MAC: 8B:EB:75:4E:65:97)...
I (xxx) BT13_MOTOR_CONTROL: –ù–∞–π–¥–µ–Ω–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ: 8b:eb:75:4e:65:97
I (xxx) BT13_MOTOR_CONTROL: –ù–∞–π–¥–µ–Ω BT13! –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–æ–∏—Å–∫...
I (xxx) BT13_MOTOR_CONTROL: BT13 –ø–æ–¥–∫–ª—é—á–µ–Ω —É—Å–ø–µ—à–Ω–æ!
I (xxx) BT13_MOTOR_CONTROL: –ì–æ—Ç–æ–≤ –∫ –ø—Ä–∏–µ–º—É –∫–æ–º–∞–Ω–¥ –æ—Ç –ø—É–ª—å—Ç–∞
```

### –ü—Ä–∏ –æ—Ç–∫–ª—é—á–µ–Ω–∏–∏/–≤–∫–ª—é—á–µ–Ω–∏–∏ –ø—É–ª—å—Ç–∞:
```
I (xxx) BT13_MOTOR_CONTROL: BT13 –æ—Ç–∫–ª—é—á–µ–Ω. –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø–æ–∏—Å–∫–∞...
I (xxx) BT13_MOTOR_CONTROL: –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø–æ–∏—Å–∫–∞ BT13 —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã...
I (xxx) BT13_MOTOR_CONTROL: –ó–∞–ø—É—Å–∫ –ø–æ–∏—Å–∫–∞ BT13...
I (xxx) BT13_MOTOR_CONTROL: –ù–∞–π–¥–µ–Ω BT13! –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–æ–∏—Å–∫...
I (xxx) BT13_MOTOR_CONTROL: BT13 –ø–æ–¥–∫–ª—é—á–µ–Ω —É—Å–ø–µ—à–Ω–æ!
```

## üîß –ö–ª—é—á–µ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### –§–∞–π–ª: main/main.c
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Å–∏–≥–Ω–∞—Ç—É—Ä–∞ `hid_host_cb`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥—Ä–æ–±–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ BT
- ‚úÖ –£–¥–∞–ª–µ–Ω—ã –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –∑–∞–¥–∞—á–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
- ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
- ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–∏—Å–∫–∞

### –§–∞–π–ª: main/CMakeLists.txt  
- ‚úÖ –£–¥–∞–ª–µ–Ω–∞ —Å—Å—ã–ª–∫–∞ –Ω–∞ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π `esp_hid_gap.c`

### –§–∞–π–ª: sdkconfig.defaults
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω —Ä–µ–∂–∏–º `CONFIG_BTDM_CTRL_MODE_BR_EDR_ONLY=y`
- ‚úÖ –û—Ç–∫–ª—é—á–µ–Ω BLE –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ –ø–∞–º—è—Ç–∏

## üéÆ –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –ø—Ä–æ—à–∏–≤–∫–∏ ESP32 –±—É–¥–µ—Ç:
- ‚úÖ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å Bluetooth –±–µ–∑ –æ—à–∏–±–æ–∫
- ‚úÖ –ò—Å–∫–∞—Ç—å BT13 –ø—É–ª—å—Ç –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
- ‚úÖ –£–ø—Ä–∞–≤–ª—è—Ç—å –¥–≤–∏–≥–∞—Ç–µ–ª–µ–º –ø–æ –∫–æ–º–∞–Ω–¥–∞–º —Å –ø—É–ª—å—Ç–∞
- ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Å—Ç–∞—Ç—É—Å —á–µ—Ä–µ–∑ LED –∏–Ω–¥–∏–∫–∞—Ü–∏—é
- ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–∞—Ç—å—Å—è** –ø—Ä–∏ –æ—Ç–∫–ª—é—á–µ–Ω–∏–∏ –ø—É–ª—å—Ç–∞
- ‚úÖ **–ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ** –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–Ω—É—Ç –ø—Ä–æ–±–ª–µ–º—ã:

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–µ—Ä—Å–∏—é ESP-IDF:**
   ```bash
   idf.py --version
   # –î–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å: ESP-IDF v5.4.1
   ```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é:**
   ```bash
   idf.py menuconfig
   # Component config ‚Üí Bluetooth ‚Üí Controller Options
   ```

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:**
   ```bash
   idf.py monitor
   # Ctrl+] –¥–ª—è –≤—ã—Ö–æ–¥–∞
   ```

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–í—Å–µ —Ñ–∞–π–ª—ã –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –≤ –ø—Ä–æ–µ–∫—Ç–µ:
- `–ò–¢–û–ì–û–í–´–ï_–ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø_v5.4.1.md` - –æ–±—â–∏–π –æ–±–∑–æ—Ä
- `–ò–°–ü–†–ê–í–õ–ï–ù–ò–ï_CALLBACK_API.md` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è API
- `–ò–°–ü–†–ê–í–õ–ï–ù–ò–ï_RUNTIME_–û–®–ò–ë–ö–ò.md` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è runtime
- `–ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ò–ô_–ü–ï–†–ï–ü–û–î–ö–õ–Æ–ß–ï–ù–ò–ï.md` - —Å–∏—Å—Ç–µ–º–∞ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
- `–§–ò–ù–ê–õ–¨–ù–ê–Ø_–ò–ù–°–¢–†–£–ö–¶–ò–Ø.md` - —ç—Ç–∞ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è

## üéâ –°—Ç–∞—Ç—É—Å –ø—Ä–æ–µ–∫—Ç–∞
üü¢ **–ü–û–õ–ù–û–°–¢–¨–Æ –ì–û–¢–û–í –ö –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Æ**

–ü—Ä–æ–µ–∫—Ç —É—Å–ø–µ—à–Ω–æ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω –¥–ª—è ESP-IDF v5.4.1 –∏ –≥–æ—Ç–æ–≤ –∫ –ø—Ä–æ—à–∏–≤–∫–µ –Ω–∞ ESP32.

---
*–í—Å–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å –ø–æ–º–æ—â—å—é OpenHands AI*  
*–î–∞—Ç–∞: 2025-06-09*  
*–í–µ—Ä—Å–∏—è ESP-IDF: v5.4.1*